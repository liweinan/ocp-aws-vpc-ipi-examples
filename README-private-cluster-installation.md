# ç§æœ‰ OpenShift é›†ç¾¤å®‰è£…æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•åœ¨æœ¬åœ°ç”Ÿæˆ `install-config.yaml` é…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨ bastion host ä¸Šå®‰è£…ç§æœ‰ OpenShift é›†ç¾¤ã€‚

## æ¦‚è¿°

ç”±äºæ‚¨è¦å®‰è£…ç§æœ‰é›†ç¾¤ï¼ˆInternal ç±»å‹ï¼‰ï¼Œå®‰è£…è¿‡ç¨‹éœ€è¦åœ¨ bastion host ä¸Šæ‰§è¡Œï¼Œå› ä¸ºç§æœ‰é›†ç¾¤çš„ API æœåŠ¡å™¨æ— æ³•ä»å¤–éƒ¨ç½‘ç»œè®¿é—®ã€‚

**æ³¨æ„ï¼š** åœ¨ä»¥ä¸‹å‘½ä»¤ä¸­ï¼Œè¯·å°† `<bastion-public-ip>` æ›¿æ¢ä¸ºæ‚¨å®é™…çš„ bastion host å…¬ç½‘ IP åœ°å€ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–ï¼š
- æŸ¥çœ‹ `bastion-output/bastion-public-ip` æ–‡ä»¶
- æˆ–è¿è¡Œ `./connect-bastion.sh` è„šæœ¬æŸ¥çœ‹è¿æ¥ä¿¡æ¯

## æ­¥éª¤ 1: æœ¬åœ°ç”Ÿæˆ install-config.yaml

### 1.1 æ£€æŸ¥å‰ç½®æ¡ä»¶

ç¡®ä¿æ‚¨å·²ç»ï¼š
- è¿è¡Œäº† `create-vpc.sh` åˆ›å»ºäº† VPC
- è¿è¡Œäº† `create-bastion.sh` åˆ›å»ºäº† bastion host
- å®‰è£…äº†å¿…è¦çš„å·¥å…·ï¼ˆyq, openshift-install, aws cliï¼‰

### 1.2 ç”Ÿæˆé…ç½®æ–‡ä»¶

åœ¨æœ¬åœ°æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ `install-config.yaml`ï¼š

```bash
# ä½¿ç”¨ dry-run æ¨¡å¼åªç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œä¸æ‰§è¡Œå®‰è£…
AWS_PROFILE=static ./deploy-openshift.sh --dry-run
```

### 1.3 äº¤äº’å¼é…ç½®

è„šæœ¬ä¼šå¯åŠ¨äº¤äº’å¼é…ç½®è¿‡ç¨‹ï¼Œæ‚¨éœ€è¦æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

```
? SSH Public Key /Users/weli/.ssh/id_rsa.pub
? Platform aws
? Region us-east-1
? Base Domain qe.devcluster.openshift.com
? Cluster Name weli-test-cluster
? Pull Secret [ç²˜è´´æ‚¨çš„ pull secret]
```

**é‡è¦æç¤ºï¼š**
- **SSH Public Key**: ä½¿ç”¨æ‚¨çš„ä¸ªäººSSHå…¬é’¥ï¼ˆç”¨äºè®¿é—®OpenShifté›†ç¾¤èŠ‚ç‚¹ï¼‰
- **Region**: å¿…é¡»ä¸ VPC æ‰€åœ¨åŒºåŸŸä¸€è‡´
- **Base Domain**: ç¡®ä¿æ‚¨æœ‰è¯¥åŸŸåçš„ DNS æ§åˆ¶æƒ
- **Pull Secret**: ä» Red Hat è·å–çš„ pull secret

### 1.4 SSHå¯†é’¥é…ç½®è¯´æ˜

**é‡è¦ï¼šOpenShifté›†ç¾¤å’ŒBastion hostä½¿ç”¨ä¸åŒçš„SSHå¯†é’¥ï¼**

- **Bastion Host**: ä½¿ç”¨ `weli-test-cluster-bastion-key` å¯†é’¥å¯¹
- **OpenShifté›†ç¾¤èŠ‚ç‚¹**: ä½¿ç”¨æ‚¨åœ¨é…ç½®æ—¶æŒ‡å®šçš„SSHå…¬é’¥ï¼ˆé€šå¸¸æ˜¯æ‚¨çš„ä¸ªäººå¯†é’¥ï¼‰

è¿™æ„å‘³ç€ï¼š
- âœ… æ‚¨å¯ä»¥ç”¨bastionå¯†é’¥è¿æ¥åˆ°bastion host
- âŒ ä½†æ‚¨æ— æ³•ä»bastion hostè¿æ¥åˆ°OpenShifté›†ç¾¤èŠ‚ç‚¹ï¼ˆå› ä¸ºèŠ‚ç‚¹ä½¿ç”¨çš„æ˜¯æ‚¨çš„ä¸ªäººSSHå¯†é’¥ï¼‰

**è§£å†³æ–¹æ¡ˆï¼šå°†æ‚¨çš„SSHç§é’¥å¤åˆ¶åˆ°Bastion Host**

```bash
# ä»æœ¬åœ°æœºå™¨æ‰§è¡Œï¼Œå¤åˆ¶æ‚¨çš„SSHç§é’¥åˆ°bastion host
scp -i ./bastion-output/weli-test-cluster-bastion-key.pem ~/.ssh/id_rsa ec2-user@<bastion-public-ip>:~/.ssh/id_rsa

# å¤åˆ¶å…¬é’¥ï¼ˆå¯é€‰ï¼Œç”¨äºéªŒè¯ï¼‰
scp -i ./bastion-output/weli-test-cluster-bastion-key.pem ~/.ssh/id_rsa.pub ec2-user@<bastion-public-ip>:~/.ssh/id_rsa.pub
```

**åœ¨bastion hostä¸Šè®¾ç½®SSHå¯†é’¥æƒé™ï¼š**

```bash
# è¿æ¥åˆ°bastion host
ssh -i ./bastion-output/weli-test-cluster-bastion-key.pem ec2-user@<bastion-public-ip>

# åœ¨bastion hostä¸Šè®¾ç½®SSHå¯†é’¥æƒé™
chmod 700 ~/.ssh
chmod 600 ~/.ssh/id_rsa
chmod 644 ~/.ssh/id_rsa.pub

# æµ‹è¯•è¿æ¥åˆ°é›†ç¾¤èŠ‚ç‚¹ï¼ˆå®‰è£…å®Œæˆåï¼‰
ssh core@<cluster-node-private-ip>
```

**éªŒè¯SSHå¯†é’¥é…ç½®ï¼š**

```bash
# åœ¨bastion hostä¸ŠéªŒè¯å¯ä»¥è®¿é—®é›†ç¾¤èŠ‚ç‚¹
export KUBECONFIG=~/openshift-cluster/auth/kubeconfig
oc get nodes
oc debug node/<node-name>
```

### 1.5 éªŒè¯ç”Ÿæˆçš„æ–‡ä»¶

è„šæœ¬å®Œæˆåï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

```
âœ… install-config.yaml generated by openshift-install!
ğŸ”§ Patching install-config.yaml with VPC configuration...
âœ… install-config.yaml patched with VPC configuration!
âœ… Backup created: install-config.yaml.backup.20250623-181958
```

ç”Ÿæˆçš„æ–‡ä»¶ä½ç½®ï¼š
- `./openshift-install/install-config.yaml` - ä¸»é…ç½®æ–‡ä»¶
- `install-config.yaml.backup.20250623-181958` - å¤‡ä»½æ–‡ä»¶

## æ­¥éª¤ 2: è¿æ¥åˆ° Bastion Host

### 2.1 ä½¿ç”¨è‡ªåŠ¨åŒ–è¿æ¥è„šæœ¬

```bash
# ä½¿ç”¨æä¾›çš„è¿æ¥è„šæœ¬
./connect-bastion.sh
```

### 2.2 æ‰‹åŠ¨è¿æ¥ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# è®¾ç½® SSH å¯†é’¥æƒé™
chmod 600 ./bastion-output/weli-test-cluster-bastion-key.pem

# è¿æ¥åˆ° bastion host
ssh -i ./bastion-output/weli-test-cluster-bastion-key.pem ec2-user@<bastion-public-ip>
```

## æ­¥éª¤ 3: åœ¨ Bastion Host ä¸Šå‡†å¤‡å®‰è£…ç¯å¢ƒ

### 3.1 ä¸Šä¼  install-config.yaml åˆ° Bastion Host

ä»æœ¬åœ°æœºå™¨ä¸Šä¼ é…ç½®æ–‡ä»¶ï¼š

```bash
# ä»æœ¬åœ°æ‰§è¡Œï¼Œä¸Šä¼ é…ç½®æ–‡ä»¶åˆ° bastion host
scp -i ./bastion-output/weli-test-cluster-bastion-key.pem ./openshift-install/install-config.yaml ec2-user@<bastion-public-ip>:~/install-config.yaml
```

### 3.2 åœ¨ Bastion Host ä¸Šä¸‹è½½ OpenShift å®‰è£…ç¨‹åº

è¿æ¥åˆ° bastion host åï¼Œä¸‹è½½å®‰è£…ç¨‹åºï¼š

```bash
# è®¾ç½®ç‰ˆæœ¬å˜é‡
OPENSHIFT_VERSION="4.18.15"

# åˆ›å»ºå®‰è£…ç›®å½•
mkdir -p ~/openshift-install
cd ~/openshift-install

# ä¸‹è½½ OpenShift å®‰è£…ç¨‹åº
wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/$OPENSHIFT_VERSION/openshift-install-linux.tar.gz
tar xzf openshift-install-linux.tar.gz
chmod +x openshift-install
rm openshift-install-linux.tar.gz

# ä¸‹è½½ oc å®¢æˆ·ç«¯
wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/$OPENSHIFT_VERSION/openshift-client-linux.tar.gz
tar xzf openshift-client-linux.tar.gz
chmod +x oc kubectl
rm openshift-client-linux.tar.gz

# éªŒè¯å®‰è£…ç¨‹åº
./openshift-install version
./oc version
```

### 3.3 é…ç½® AWS å‡­è¯

ç¡®ä¿ bastion host æœ‰æ­£ç¡®çš„ AWS å‡­è¯ã€‚æ¨èä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä»æœ¬åœ°æœºå™¨ä¸Šä¼ å‡­è¯ï¼š

#### æ–¹æ³• 1: ä¸Šä¼  AWS å‡­è¯æ–‡ä»¶ï¼ˆæ¨èï¼‰

**ä»æœ¬åœ°æœºå™¨æ‰§è¡Œï¼š**

```bash
# ä¸Šä¼  AWS å‡­è¯æ–‡ä»¶åˆ° bastion host
scp -i ./bastion-output/weli-test-cluster-bastion-key.pem ~/.aws/credentials ec2-user@<bastion-public-ip>:~/.aws/credentials

# ä¸Šä¼  AWS é…ç½®æ–‡ä»¶
scp -i ./bastion-output/weli-test-cluster-bastion-key.pem ~/.aws/config ec2-user@<bastion-public-ip>:~/.aws/config
```

**åœ¨ bastion host ä¸Šè®¾ç½®æƒé™ï¼š**

```bash
# è¿æ¥åˆ° bastion host
ssh -i ./bastion-output/weli-test-cluster-bastion-key.pem ec2-user@<bastion-public-ip>

# åœ¨ bastion host ä¸Šåˆ›å»º .aws ç›®å½•å¹¶è®¾ç½®æƒé™
mkdir -p ~/.aws
chmod 700 ~/.aws
chmod 600 ~/.aws/credentials
chmod 600 ~/.aws/config

# éªŒè¯å‡­è¯
aws sts get-caller-identity --profile static
```

#### æ–¹æ³• 2: ä½¿ç”¨ç¯å¢ƒå˜é‡

**ä»æœ¬åœ°æœºå™¨æ‰§è¡Œï¼š**

```bash
# è·å–æ‚¨çš„ AWS å‡­è¯å¹¶ä¸Šä¼ åˆ° bastion host
aws configure export-credentials --profile static --format env | ssh -i ./bastion-output/weli-test-cluster-bastion-key.pem ec2-user@<bastion-public-ip> "cat > ~/aws-env.sh"
```

**åœ¨ bastion host ä¸Šä½¿ç”¨ï¼š**

```bash
# è¿æ¥åˆ° bastion host
ssh -i ./bastion-output/weli-test-cluster-bastion-key.pem ec2-user@<bastion-public-ip>

# åŠ è½½ç¯å¢ƒå˜é‡
source ~/aws-env.sh

# éªŒè¯å‡­è¯
aws sts get-caller-identity
```

#### æ–¹æ³• 3: æ‰‹åŠ¨é…ç½®

**åœ¨ bastion host ä¸Šæ‰§è¡Œï¼š**

```bash
# åˆ›å»º .aws ç›®å½•
mkdir -p ~/.aws

# é…ç½® AWS å‡­è¯
aws configure --profile static

# æˆ–è€…è®¾ç½®ç¯å¢ƒå˜é‡
export AWS_PROFILE=static
export AWS_DEFAULT_REGION=us-east-1

# éªŒè¯å‡­è¯
aws sts get-caller-identity
```

**é‡è¦æç¤ºï¼š**
- ç¡®ä¿ `.aws` ç›®å½•æƒé™ä¸º 700
- ç¡®ä¿ `credentials` å’Œ `config` æ–‡ä»¶æƒé™ä¸º 600
- ä½¿ç”¨ `--profile static` å‚æ•°æ¥æŒ‡å®šæ­£ç¡®çš„é…ç½®æ–‡ä»¶

### 3.4 é…ç½®SSHå¯†é’¥è®¿é—®é›†ç¾¤èŠ‚ç‚¹

**é‡è¦ï¼šä¸ºäº†èƒ½å¤Ÿä»bastion hostè®¿é—®OpenShifté›†ç¾¤èŠ‚ç‚¹ï¼Œæ‚¨éœ€è¦å¤åˆ¶æ‚¨çš„SSHç§é’¥åˆ°bastion hostã€‚**

#### ä»æœ¬åœ°æœºå™¨å¤åˆ¶SSHå¯†é’¥

```bash
# å¤åˆ¶æ‚¨çš„SSHç§é’¥åˆ°bastion host
scp -i ./bastion-output/weli-test-cluster-bastion-key.pem ~/.ssh/id_rsa ec2-user@<bastion-public-ip>:~/.ssh/id_rsa

# å¤åˆ¶å…¬é’¥ï¼ˆå¯é€‰ï¼Œç”¨äºéªŒè¯ï¼‰
scp -i ./bastion-output/weli-test-cluster-bastion-key.pem ~/.ssh/id_rsa.pub ec2-user@<bastion-public-ip>:~/.ssh/id_rsa.pub
```

#### åœ¨bastion hostä¸Šè®¾ç½®SSHå¯†é’¥æƒé™

```bash
# è¿æ¥åˆ°bastion host
ssh -i ./bastion-output/weli-test-cluster-bastion-key.pem ec2-user@<bastion-public-ip>

# åœ¨bastion hostä¸Šè®¾ç½®SSHå¯†é’¥æƒé™
chmod 700 ~/.ssh
chmod 600 ~/.ssh/id_rsa
chmod 644 ~/.ssh/id_rsa.pub

# éªŒè¯SSHå¯†é’¥é…ç½®
ls -la ~/.ssh/
```

#### éªŒè¯SSHå¯†é’¥é…ç½®

å®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥æµ‹è¯•SSHè¿æ¥åˆ°é›†ç¾¤èŠ‚ç‚¹ï¼š

```bash
# è·å–é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯
export KUBECONFIG=~/openshift-cluster/auth/kubeconfig
oc get nodes -o wide

# æµ‹è¯•SSHè¿æ¥åˆ°é›†ç¾¤èŠ‚ç‚¹ï¼ˆä½¿ç”¨èŠ‚ç‚¹å†…éƒ¨IPï¼‰
ssh core@<cluster-node-private-ip>

# æˆ–è€…ä½¿ç”¨oc debugå‘½ä»¤è®¿é—®èŠ‚ç‚¹
oc debug node/<node-name>
```

**æ³¨æ„ï¼š**
- Bastion hostä½¿ç”¨ `weli-test-cluster-bastion-key` å¯†é’¥å¯¹
- OpenShifté›†ç¾¤èŠ‚ç‚¹ä½¿ç”¨æ‚¨çš„ä¸ªäººSSHå¯†é’¥
- å¤åˆ¶ç§é’¥åï¼Œæ‚¨å°±å¯ä»¥ä»bastion hostå®Œå…¨è®¿é—®é›†ç¾¤èŠ‚ç‚¹äº†

## æ­¥éª¤ 4: æ‰§è¡Œé›†ç¾¤å®‰è£…

### 4.1 å‡†å¤‡å®‰è£…ç›®å½•

```bash
# åˆ›å»ºä¸“ç”¨çš„é›†ç¾¤å®‰è£…ç›®å½•
mkdir -p ~/openshift-cluster
cd ~/openshift-cluster

# å¤åˆ¶é…ç½®æ–‡ä»¶
cp ~/install-config.yaml .

# å¤åˆ¶ OpenShift å®‰è£…ç¨‹åºåˆ°å½“å‰ç›®å½•
cp ~/openshift-install/openshift-install .
cp ~/openshift-install/oc .
cp ~/openshift-install/kubectl .

# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x openshift-install oc kubectl

# éªŒè¯å®‰è£…ç¨‹åº
./openshift-install version
./oc version

# éªŒè¯é…ç½®æ–‡ä»¶
./openshift-install create install-config --dir=. --dry-run
```

### 4.2 å¼€å§‹å®‰è£…

```bash
# å¼€å§‹é›†ç¾¤å®‰è£…ï¼ˆè¯¦ç»†æ—¥å¿—æ¨¡å¼ï¼‰
./openshift-install --log-level=info create cluster --dir=.

# æˆ–è€…ä½¿ç”¨åå°è¿è¡Œï¼ˆæ¨èç”¨äºé•¿æ—¶é—´å®‰è£…ï¼‰
nohup ./openshift-install --log-level=info create cluster --dir=. > install.log 2>&1 &
```

### 4.3 ç›‘æ§å®‰è£…è¿›åº¦

```bash
# æŸ¥çœ‹å®‰è£…æ—¥å¿—
tail -f install.log

# æˆ–è€…å®æ—¶æŸ¥çœ‹å®‰è£…è¿›åº¦
./openshift-install --log-level=info create cluster --dir=. 2>&1 | tee install.log
```

### 4.4 å®‰è£…å®Œæˆåçš„éªŒè¯

å®‰è£…å®Œæˆåï¼Œæ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

```
INFO Install complete!
INFO To access the cluster as the system:admin user when using 'oc', run 'export KUBECONFIG=/home/ec2-user/openshift-cluster/auth/kubeconfig'
INFO Access the OpenShift web-console here: https://console-openshift-console.apps.weli-test-cluster.qe.devcluster.openshift.com
INFO Login to the console with user: "kubeadmin", and password: "xxxxx-xxxxx-xxxxx-xxxxx"
```

## æ­¥éª¤ 5: è®¿é—®é›†ç¾¤

### 5.1 è®¾ç½®ç¯å¢ƒå˜é‡

```bash
# è®¾ç½® kubeconfig
export KUBECONFIG=/home/ec2-user/openshift-cluster/auth/kubeconfig

# éªŒè¯é›†ç¾¤è®¿é—®
./oc whoami
./oc get nodes
```

### 5.2 è®¿é—® Web æ§åˆ¶å°

ä» bastion host è®¿é—®æ§åˆ¶å°ï¼š

```bash
# ä½¿ç”¨ curl æµ‹è¯•æ§åˆ¶å°è®¿é—®
curl -k https://console-openshift-console.apps.weli-test-cluster.qe.devcluster.openshift.com

# æˆ–è€…ä½¿ç”¨ SSH éš§é“ä»æœ¬åœ°è®¿é—®
# åœ¨æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œï¼š
ssh -i ./bastion-output/weli-test-cluster-bastion-key.pem -L 8443:console-openshift-console.apps.weli-test-cluster.qe.devcluster.openshift.com:443 ec2-user@<bastion-public-ip>
```

ç„¶ååœ¨æœ¬åœ°æµè§ˆå™¨è®¿é—®ï¼š`https://localhost:8443`

## æ­¥éª¤ 6: ä¸‹è½½é›†ç¾¤è®¿é—®æ–‡ä»¶

### 6.1 ä» Bastion Host ä¸‹è½½é‡è¦æ–‡ä»¶

```bash
# åœ¨æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œï¼Œä¸‹è½½é›†ç¾¤è®¿é—®æ–‡ä»¶
scp -i ./bastion-output/weli-test-cluster-bastion-key.pem ec2-user@<bastion-public-ip>:~/openshift-cluster/auth/kubeconfig ~/kubeconfig-weli-test-cluster
scp -i ./bastion-output/weli-test-cluster-bastion-key.pem ec2-user@<bastion-public-ip>:~/openshift-cluster/auth/kubeadmin-password ~/kubeadmin-password-weli-test-cluster
```

### 6.2 åœ¨æœ¬åœ°ä½¿ç”¨é›†ç¾¤

```bash
# è®¾ç½® kubeconfig
export KUBECONFIG=~/kubeconfig-weli-test-cluster

# éªŒè¯è®¿é—®
oc whoami
oc get nodes
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å®‰è£…å¡ä½æˆ–å¤±è´¥**
   ```bash
   # æ£€æŸ¥ AWS èµ„æº
   aws ec2 describe-instances --filters "Name=tag:kubernetes.io/cluster/weli-test-cluster,Values=owned"
   
   # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   tail -f install.log
   ```

2. **ç½‘ç»œè¿æ¥é—®é¢˜**
   ```bash
   # æ£€æŸ¥ VPC é…ç½®
   aws ec2 describe-vpcs --vpc-ids vpc-04d8f5e06211f6de6
   
   # æ£€æŸ¥å®‰å…¨ç»„
   aws ec2 describe-security-groups --filters "Name=vpc-id,Values=vpc-04d8f5e06211f6de6"
   ```

3. **æƒé™é—®é¢˜**
   ```bash
   # éªŒè¯ AWS æƒé™
   aws iam get-user
   aws iam list-attached-user-policies --user-name <your-username>
   ```

4. **openshift-install æ‰¾ä¸åˆ°**
   ```bash
   # ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•ä¸­
   pwd
   ls -la openshift-install
   
   # å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‡æ–°å¤åˆ¶
   cp ~/openshift-install/openshift-install .
   chmod +x openshift-install
   ```

5. **SSHå¯†é’¥è®¿é—®é—®é¢˜**
   ```bash
   # æ£€æŸ¥SSHå¯†é’¥æƒé™
   ls -la ~/.ssh/
   
   # ç¡®ä¿ç§é’¥æƒé™æ­£ç¡®
   chmod 600 ~/.ssh/id_rsa
   chmod 644 ~/.ssh/id_rsa.pub
   
   # æµ‹è¯•SSHè¿æ¥åˆ°é›†ç¾¤èŠ‚ç‚¹
   ssh -i ~/.ssh/id_rsa core@<cluster-node-ip>
   
   # å¦‚æœæ— æ³•è¿æ¥ï¼Œæ£€æŸ¥èŠ‚ç‚¹å®‰å…¨ç»„æ˜¯å¦å…è®¸SSH
   aws ec2 describe-security-groups --filters "Name=tag:kubernetes.io/cluster/weli-test-cluster,Values=owned"
   ```

6. **æ— æ³•ä»bastion hostè®¿é—®é›†ç¾¤èŠ‚ç‚¹**
   ```bash
   # æ£€æŸ¥æ˜¯å¦å¤åˆ¶äº†æ­£ç¡®çš„SSHç§é’¥
   ls -la ~/.ssh/id_rsa
   
   # é‡æ–°å¤åˆ¶SSHç§é’¥ï¼ˆä»æœ¬åœ°æœºå™¨æ‰§è¡Œï¼‰
   scp -i ./bastion-output/weli-test-cluster-bastion-key.pem ~/.ssh/id_rsa ec2-user@<bastion-public-ip>:~/.ssh/id_rsa
   
   # åœ¨bastion hostä¸Šè®¾ç½®æƒé™
   chmod 600 ~/.ssh/id_rsa
   
   # éªŒè¯é›†ç¾¤èŠ‚ç‚¹è®¿é—®
   export KUBECONFIG=~/openshift-cluster/auth/kubeconfig
   oc get nodes -o wide
   ssh core@<node-internal-ip>
   ```

### é‡æ–°å¼€å§‹å®‰è£…

å¦‚æœå®‰è£…å¤±è´¥éœ€è¦é‡æ–°å¼€å§‹ï¼š

```bash
# æ¸…ç†å®‰è£…ç›®å½•
rm -rf ~/openshift-cluster

# é‡æ–°åˆ›å»ºç›®å½•å¹¶å¤åˆ¶é…ç½®æ–‡ä»¶
mkdir -p ~/openshift-cluster
cd ~/openshift-cluster
cp ~/install-config.yaml .
cp ~/openshift-install/openshift-install .
cp ~/openshift-install/oc .
cp ~/openshift-install/kubectl .
chmod +x openshift-install oc kubectl

# é‡æ–°å¼€å§‹å®‰è£…
./openshift-install --log-level=info create cluster --dir=.
```

## æ¸…ç†èµ„æº

å®‰è£…å®Œæˆåï¼Œå¦‚æœéœ€è¦åˆ é™¤é›†ç¾¤ï¼š

```bash
# åœ¨ bastion host ä¸Šæ‰§è¡Œ
cd ~/openshift-cluster
./openshift-install destroy cluster --dir=.
```

## æ€»ç»“

1. **æœ¬åœ°ç”Ÿæˆé…ç½®**: ä½¿ç”¨ `deploy-openshift.sh --dry-run` ç”Ÿæˆ `install-config.yaml`
2. **ä¸Šä¼ åˆ° Bastion**: å°†é…ç½®æ–‡ä»¶ä¸Šä¼ åˆ° bastion host
3. **å‡†å¤‡ç¯å¢ƒ**: åœ¨ bastion host ä¸Šä¸‹è½½å®‰è£…ç¨‹åºå¹¶é…ç½® AWS å‡­è¯
4. **é…ç½®SSHå¯†é’¥**: å¤åˆ¶æ‚¨çš„SSHç§é’¥åˆ°bastion hostä»¥è®¿é—®é›†ç¾¤èŠ‚ç‚¹
5. **åˆ›å»ºå®‰è£…ç›®å½•**: ä½¿ç”¨ `~/openshift-cluster` ä½œä¸ºä¸“ç”¨å®‰è£…ç›®å½•
6. **æ‰§è¡Œå®‰è£…**: ä½¿ç”¨ `openshift-install create cluster` å¼€å§‹å®‰è£…
7. **ç›‘æ§è¿›åº¦**: ä½¿ç”¨è¯¦ç»†æ—¥å¿—æ¨¡å¼ç›‘æ§å®‰è£…è¿‡ç¨‹
8. **è®¿é—®é›†ç¾¤**: é€šè¿‡ kubeconfig æˆ– Web æ§åˆ¶å°è®¿é—®é›†ç¾¤

è¿™ä¸ªæµç¨‹ç¡®ä¿äº†ç§æœ‰é›†ç¾¤èƒ½å¤Ÿæ­£ç¡®å®‰è£…ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥ä» bastion host è®¿é—®é›†ç¾¤çš„æ‰€æœ‰åŠŸèƒ½ã€‚

**é‡è¦æé†’ï¼š**
- Bastion hostå’ŒOpenShifté›†ç¾¤ä½¿ç”¨ä¸åŒçš„SSHå¯†é’¥
- å¿…é¡»å°†æ‚¨çš„ä¸ªäººSSHç§é’¥å¤åˆ¶åˆ°bastion hostæ‰èƒ½è®¿é—®é›†ç¾¤èŠ‚ç‚¹
- ç¡®ä¿SSHå¯†é’¥æƒé™è®¾ç½®æ­£ç¡®ï¼ˆç§é’¥600ï¼Œå…¬é’¥644ï¼‰