# Cleanup Script

The `cleanup.sh` script is used to clean up local files generated by the automation scripts and optionally delete AWS resources.

## ğŸš€ Quick Start

```bash
# Make script executable
chmod +x cleanup.sh

# Clean local files only (default)
./cleanup.sh

# Clean local files and AWS resources
./cleanup.sh --clean-aws

# Preview cleanup operations
./cleanup.sh --dry-run

# Force cleanup (skip confirmations)
./cleanup.sh --force
```

## ğŸ“‹ Features

- **Local File Cleanup**: Remove output directories and generated files
- **AWS Resource Cleanup**: Optional deletion of AWS resources
- **Dry Run Mode**: Preview operations without executing
- **Selective Cleanup**: Choose what to clean
- **Safety Confirmations**: User confirmation for destructive operations

## ğŸ”§ Command Line Options

| Option | Description | Default | Required |
|--------|-------------|---------|----------|
| `--clean-aws` | Also clean AWS resources | `false` | No |
| `--dry-run` | Preview operations without executing | `false` | No |
| `--force` | Skip confirmation prompts | `false` | No |
| `--help` | Display help message | N/A | No |

## ğŸ§¹ Cleanup Content

### Local Files (Default)
- `vpc-output/` - VPC creation output directory
- `bastion-output/` - Bastion host output directory
- `openshift-install/` - OpenShift installation directory
- `*.pem` - SSH key files
- `logs/` - Log files directory
- Temporary files and caches

### AWS Resources (with `--clean-aws`)
- CloudFormation stacks
- EC2 instances
- SSH key pairs
- Security groups
- Other AWS resources created by scripts

## ğŸ“Š Example Output

### Dry Run Mode
```
ğŸ§¹ Cleanup Script
==================

ğŸ“‹ Configuration:
   Clean AWS Resources: no
   Dry Run: yes
   Force Mode: no

â„¹ï¸  DRY RUN MODE - No files or resources will be actually deleted

ğŸ“ Local Files to Clean:
   - ./vpc-output/
   - ./bastion-output/
   - ./openshift-install/
   - *.pem files
   - ./logs/

ğŸŒ AWS Resources to Clean:
   None (--clean-aws not specified)

ğŸ“Š Cleanup Summary
==================
â„¹ï¸  DRY RUN COMPLETED - No files or resources were actually deleted

To perform actual cleanup, run the script without --dry-run
```

### Actual Cleanup
```
ğŸ§¹ Cleanup Script
==================

ğŸ“‹ Configuration:
   Clean AWS Resources: yes
   Dry Run: no
   Force Mode: no

âš ï¸  This will delete local files and AWS resources!
   - Local directories: vpc-output, bastion-output, openshift-install
   - SSH key files: *.pem
   - AWS resources: CloudFormation stacks, EC2 instances, etc.

Do you want to proceed? (y/N): y

ğŸ“ Cleaning Local Files
------------------------
â„¹ï¸  Removing directory: ./vpc-output
âœ… Removed: ./vpc-output
â„¹ï¸  Removing directory: ./bastion-output
âœ… Removed: ./bastion-output
â„¹ï¸  Removing directory: ./openshift-install
âœ… Removed: ./openshift-install
â„¹ï¸  Removing SSH key files: *.pem
âœ… Removed: my-cluster-key.pem
âœ… Removed: my-cluster-bastion-key.pem

ğŸŒ Cleaning AWS Resources
--------------------------
â„¹ï¸  Finding CloudFormation stacks...
â„¹ï¸  Found stack: my-cluster-vpc-1750419818
â„¹ï¸  Deleting CloudFormation stack: my-cluster-vpc-1750419818
âœ… Stack deletion initiated
â„¹ï¸  Finding SSH key pairs...
â„¹ï¸  Deleting SSH key pair: my-cluster-key
âœ… SSH key pair deleted
â„¹ï¸  Deleting SSH key pair: my-cluster-bastion-key
âœ… SSH key pair deleted

ğŸ“Š Cleanup Summary
==================
âœ… Local files cleaned successfully
âœ… AWS resources cleaned successfully
âœ… 1 CloudFormation stack deleted
âœ… 2 SSH key pairs deleted

ğŸ‰ Cleanup completed successfully!
```

## ğŸ”„ Usage Scenarios

### Development Environment Cleanup
```bash
# Clean up after testing
./cleanup.sh --dry-run
./cleanup.sh
```

### Complete Environment Cleanup
```bash
# Clean everything including AWS resources
./cleanup.sh --clean-aws --dry-run
./cleanup.sh --clean-aws
```

### Automated Cleanup
```bash
# Use in scripts without prompts
./cleanup.sh --force
./cleanup.sh --clean-aws --force
```

## âš ï¸ Important Warnings

### Data Loss
- **Local files are permanently deleted** - Ensure you have backups
- **AWS resources are permanently deleted** - This affects running services
- **No recovery option** - Deleted resources cannot be restored

### Safety Measures
- Always use `--dry-run` first to preview operations
- Review the list of files and resources before confirming
- Keep backups of important configuration files
- Use `--force` only in automated environments

## ğŸ†˜ Troubleshooting

### Permission Issues
```bash
# Check file permissions
ls -la vpc-output/ bastion-output/ openshift-install/

# Fix permissions if needed
chmod -R 755 vpc-output/ bastion-output/ openshift-install/
```

### AWS Resource Issues
```bash
# Check AWS credentials
aws sts get-caller-identity

# Check CloudFormation stacks
aws cloudformation list-stacks --stack-status-filter CREATE_COMPLETE UPDATE_COMPLETE
```

### Partial Cleanup
```bash
# Manual cleanup of specific directories
rm -rf vpc-output/
rm -rf bastion-output/
rm -rf openshift-install/
rm -f *.pem
```

## ğŸ’¡ Best Practices

### Before Cleanup
1. **Create backups** of important configuration files
2. **Verify resources** to be deleted with `--dry-run`
3. **Notify team members** if working in shared environment
4. **Check dependencies** to avoid breaking other services

### After Cleanup
1. **Verify deletion** of all intended resources
2. **Update documentation** if needed
3. **Monitor AWS costs** to confirm resource removal
4. **Archive backups** for future reference

## ğŸ”„ Integration with Other Scripts

### Workflow Integration
```bash
# Complete workflow with cleanup
./create-vpc.sh --cluster-name my-cluster
./deploy-openshift.sh --cluster-name my-cluster --base-domain example.com
./create-bastion.sh --cluster-name my-cluster

# ... use cluster ...

# Cleanup when done
./cleanup.sh --clean-aws
```

### Backup Before Cleanup
```bash
# Create backup before cleanup
./backup.sh --include-configs --include-ssh-keys

# Then cleanup
./cleanup.sh --clean-aws
```

## ğŸ“š Related Documentation

- [Backup Script](README-backup.md) - Create backups before cleanup
- [Delete VPC Scripts](README-delete-vpc.md) - Alternative deletion methods
- [AWS CloudFormation](https://docs.aws.amazon.com/cloudformation/) - AWS resource management
- [AWS CLI](https://docs.aws.amazon.com/cli/) - AWS command line interface 